#!/bin/sh
#-*-coding:utf-8-unix;-*-
echo cmake -DCMAKE_BUILD_TYPE=MinSizeRel \
      -DCMAKE_INSTALL_PREFIX=/usr/local/llvm/pass1 \
      -DLLVM_TARGETS_TO_BUILD="X86" \
      -DLLVM_HOST_TRIPLE="x86_64-pc-linux-gnu" \
      -DLLVM_BUILD_UTILS=OFF \
      -DLLVM_ENABLE_ZLIB=OFF \
      -DLLVM_BUILD_LLVM_DYLIB=ON \
      -DLLVM_LINK_LLVM_DYLIB=ON \
      -DCLANG_DEFAULT_CXX_STDLIB=libc++ \
      -DCLANG_DEFAULT_RTLIB=compiler-rt \
      -DCLANG_DEFAULT_LINKER=lld \
      -DLIBCXX_ENABLE_STATIC_ABI_LIBRARY=ON \
      -DLIBCXXABI_ENABLE_SHARED=OFF \
      -DLIBCXX_ENABLE_SHARED=OFF \
      -DLIBUNWIND_ENABLE_SHARED=OFF \
      -G Ninja \
      $1
export LLVM_ROOT=/usr/local/llvm/pass1
CC=$LLVM_ROOT/bin/clang
CXX=$LLVM_ROOT/bin/clang++
#LD=$LLVM_ROOT/bin/lld
LDFLAGS="-lunwind -lpthread -ldl"
#-DCMAKE_SHARED_LINKER_FLAGS="-lunwind -ldl" \
#      -DCMAKE_EXE_LINKER_FLAGS="-lunwind" \
#-DCLANG_ENABLE_BOOTSTRAP=ON \

cmake \
    -DCMAKE_C_COMPILER=$LLVM_ROOT/bin/clang \
    -DCMAKE_CXX_COMPILER=$LLVM_ROOT/bin/clang++ \
    -DCMAKE_BUILD_TYPE=MinSizeRel \
    -DCMAKE_INSTALL_PREFIX=/usr/local/llvm/pass1 \
    -DLLVM_TARGETS_TO_BUILD="X86" \
    -DLLVM_HOST_TRIPLE="x86_64-pc-linux-gnu" \
    -DLLVM_ENABLE_ZLIB=OFF \
    -DLLVM_BUILD_LLVM_DYLIB=ON \
    -DLLVM_LINK_LLVM_DYLIB=ON \
    -DLLVM_ENABLE_LIBCXX=ON \
    -DLLVM_ENABLE_OCAMLDOC=OFF \
    -DLLVM_BUILD_UTILS=OFF \
    -DCLANG_DEFAULT_CXX_STDLIB=libc++ \
    -DCLANG_DEFAULT_RTLIB=compiler-rt \
    -DCLANG_DEFAULT_LINKER=lld \
    -DLIBCXX_ENABLE_STATIC_ABI_LIBRARY=ON \
    -DLIBCXXABI_SILENT_TERMINATE=ON \
    -DLIBCXXABI_ENABLE_SHARED=OFF \
    -DLIBCXXABI_ENABLE_STATIC_UNWINDER=ON \
    -DLIBCXXABI_USE_COMPILER_RT=ON \
    -DLIBCXXABI_USE_LLVM_UNWINDER=ON \
    -DLIBCXXABI_ENABLE_THREADS=OFF \
    -DLIBCXX_ENABLE_SHARED=OFF \
    -DLIBCXX_USE_COMPILER_RT=ON \
    -DLIBCXX_ENABLE_RTTI=OFF \
    -DLIBUNWIND_ENABLE_SHARED=OFF \
    -DLIBUNWIND_USE_COMPILER_RT=ON \
    -DLIBUNWIND_ENABLE_THREADS=OFF \
    -G Ninja \
    $1
